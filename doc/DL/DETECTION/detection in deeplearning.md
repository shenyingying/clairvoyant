#深度学习中的目标检测
##深度学习中检测任务基本流程：
1. 生成候选区域：确定搜索范围（滑动窗口+图像金字塔等）
2. 提取区域特征：将候选区域表示成定长向量
3. 对区域进行分类：确定是否包含物体及其所属类别
4. 后处理：对重叠较多的框进行合并，希望同一个物体上有且只有一个检测框

### 目标检测用深度学习和传统方法对比
|         |传统方法 |  深度方法 |
|:--------|:-------|:-------|
|表示|手工设计底层级特征| 数据驱动的表示学习机制|
| |1.依赖于经验知识，一般针对特定类别进行设计;|1.根据训练的数据自适应地构造特征提取器;
| |2.没有考虑数据的分布特征;               |2.需要大量的带标注的数据;
| |3.不具有或者只具有较弱的语义信息;表达能力较弱，难以描述物体的复杂变化;|3.学习过程和所学到的表示难以进行解释;
| |4.表达能力较弱，难以描述物体的复杂变化。|
|模型|线性或者简单的非线性模型 |高度非线性模型|
| |1.建模能力弱，往往需要融合多个模型;|1.能有效建模物体的复杂变化模式;
| |2.难以扩展到多类目标检测;|2.可以方便的从单类别扩展到多类别;
| |3.分类器学习和特征提取是两个独立的过程;|3.特征提取和分类器可以整体进行端到端的训练;
| |4.多个模块需要分别训练;|4.模型的计算复杂度高;
| | |5.理论上难以分析，泛化，收敛，样本的复杂性等;


####两阶段







两阶段：
1.生成可能包含物体的候选区域region proposal
2.对候选区域作出进一步分类和校准，得到最终的检测结果
3.典型模型
A:Pipeline:
RCNN->(SPP-net)->Fast R-CNN ->Faster R-CNN
后续工作
OHEM（2016）：训练过程引入难例挖掘策略
R-FCN（2016）：针对ResNet优化检测器结构进一步加速
FPN（2016）：构造特征金字塔提升尺度鲁棒性能
DCN（2016）：设计可变形卷积和Roi Pooling 提升形变鲁棒性
Mask R-CNN（2017）：引入实例分割进行多任务协同
B:Structure

①　用有监督的预训练解决表示学习需要大量标注数据的问题;
②　仅生成少量候选区域来解决模型计算速度慢的问题;
第一步：生成候选区域：
专门的候选区域生成方法，Selective search：
用现有的分割方法将图像快速划分为多个区域;
基于相似度对相邻的区域进行合并;
不断合并区域直到整张图像成为一个区域（层次化的区域合并）;
在合并区域的过程中，基于所有产生的区域给出对应的矩形框，得到用于目标检测的候选区域;（穷举）
第二步：用CNN进行特征提取：
将不同大小的区域缩放到相同的大小(227*227)-{对区域稍许扩大已包含上下文信息}
将所有区域送如AlexNet提取特征：5个卷积，2个全链接层;
以最后一个全链接层的输出作为区域的特征表示：4096维度
有监督预训练{Pretraining}（ImageNet，120W，1000类 ）
针对目标任务进行微调{Fine-tuning}（PascalVOC，成千上万，20类）
{用大量数据学习的预训练模型，其提取特征已经具有较好的数据迁移能力}
第三步：用CNN进行特征提取+边框校准：
区域分类-线性SVM/Softmax
边框校准-线性回归

检测速率：
类目	Selective search	Cropping
resize	CNN feature	Region
Classification	NMS
20类	2.1s	2.6s	5.9s	不计	不计
200类	2.1s	2.6s	5.9s		

问题：vs 方案
要求CNN输入图像具有统一尺寸;


方案：SPP-net


问题 vs 方案：
R-CNN 和SPP-net的训练都包含多个单独的步骤：
(1)对网络进行微调
 -R-CNN对整个CNN进行微调
 -SPP-net只需要对SPP之后的（全连接）层进行微调
(2)训练SVM;训练边框回归模型
 -时间长：需要用CNN提取所有的训练样本的特征
 -占用存储空间大：所有样本的特征需要存储到磁盘上。
检测速度慢：

方案 Fast R-CNN


①　边框回归 Smooth L1 Loss
②　全连接层加速：Truncated SVD
问题 vs 方案：
-Fast R-CNN仍然需要专门的候选窗口生成模块
Selective Search：CPU 2s/图
其他方法：EdgeBox，GPU，0.2s/图（和CNN分类所需时间相当）
方案 Faster-RCNN (RPN)（5帧/s）




模型学习：
交替式的四步法训练
基于预训练模型训练RPN
基于预训练模型，以及上一步得到的RPN，训练Fast R-CNN
固定共享的卷积层，训练RPN
固定共享的卷积层，基于上一步得到的RPN，训练Fast R-CNN
端到端的训练
同时学习RPN和分类网络
分类网络的梯度不向RPN回传
不同检测器比较


S-FCN：卷积到底的Faster-RCNN
FCN：金字塔Faster-RCN
单阶段
1.给出最终的检测结果;
2.没有显示的显示候选区域的步骤
YOLO 
  —网格式的检测方式
  —综合整张图的信息预测各个位置的物体
  —YOLO（2015），YOLO9000（2016）
检测精度和速度
—精度：map 60
  —速度：tian x（155）; NVIDIA tx2（20）;树莓派3B+神经棒（9）;
存在问题
 —小尺度问题
 —密集排布问题
 —检测框的准确性
SSD
 —吸纳两阶段检测器的优秀设计，并进行改良
 —SSD（2015），DSSD（2017）
 —如何保证精度
对不同长宽比
RetinaNet（2017）
 —大幅度提升单阶段检测器的精度
评价